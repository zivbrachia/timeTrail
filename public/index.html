<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Complex Polylines</title>
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

        #map {
            height: 100%;
        }

        /* Optional: Makes the sample page fill the window. */

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <div id="control">
        <input type="button" value="next offset" onclick="addCoords()">
        <input type="button" value="watch position" onclick="watchPosition()">
        <input type="button" value="clear watch" onclick="clearWatch()">
    </div>
    <div id="output">
    </div>
    <div id="map"></div>
    <script>
        // This example creates an interactive map which constructs a polyline based on
        // user clicks. Note that the polyline only appears once its path property
        // contains two LatLng coordinates.

        var poly;
        var map;
        var lineSymbol;
        var pathGps = {pathGps};
        var watchId;
        var marker;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 32.053109, lng: 34.780164 },
                zoom: 16
            });

            lineSymbol = {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 8,
                strokeColor: '#393'
            };

            poly = new google.maps.Polyline({
                strokeColor: '#000000',
                strokeOpacity: 1.0,
                strokeWeight: 3,
                icons: [{ icon: lineSymbol, offset: '100%' }]
            });

            poly.setMap(map);

            marker = new google.maps.Marker();
            marker.setMap(map);
            // Add a listener for the click event
            //map.addListener('click', addLatLng);
        }

        // Handles click events on a map, and adds a new point to the Polyline.
        function addLatLng(event) {
            var path = poly.getPath();

            // Because path is an MVCArray, we can simply append a new coordinate
            // and it will automatically appear.
            path.push(event.latLng);

            // Add a new marker at the new plotted point on the polyline.
            var marker = new google.maps.Marker({
                position: event.latLng,
                title: '#' + path.getLength(),
                map: map
            });
        }

        function addCoords() {
            var coords = pathGps.splice(0, 1);
            var path = poly.getPath();
            path.push(new google.maps.LatLng(coords[0].lat, coords[0].lng));
        }

        function watchPosition() {
            //setInterval(function () {
                var watchId = navigator.geolocation.watchPosition(
                    // Success
                    function (position) {
                        document.getElementById("output").innerHTML = 'currentLat ' + position.coords.latitude + ' currentLon ' + position.coords.longitude;
                        //console.log('currentLat ' + position.coords.latitude);
                        //console.log('currentLon ' + position.coords.longitude);
                        var center = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                        map.panTo(center);


                        marker.setPosition(center);
                        marker.setIcon(google.maps.SymbolPath.CIRCLE);
                        //position: map.getCenter(),
                        //icon: {
                        //    path: google.maps.SymbolPath.CIRCLE,
                        //    scale: 10
                        //}
                        //});
                    },
                    // Error
                    function (error) {
                        document.getElementById("output").innerHTML = 'error: ' + error;
                    },
                    // PositionOptions
                    {
                        enableHighAccuracy: false,
                        timeout: 1000,
                        maximumAge: 0
                    }
             );
            //}, 1000);
        }

        function clearWatch() {
            navigator.geolocation.clearWatch(watchId);
        }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI_p2k0-PSoet-1fvZ5wBMOuZnNAPx3Bw&callback=initMap">
    </script>
</body>

</html>